# Kanban Board Route Rules

This document provides specific guidance for working with the Kanban board feature at `/kanban`.

## Architecture Overview

The Kanban board is built with a modular component architecture:

- **Route**: `/app/kanban/page.tsx` - Main route entry point
- **Hook**: `/hooks/use-kanban.ts` - State management and persistence
- **Types**: `/lib/kanban-types.ts` - TypeScript interfaces
- **Components**: `/components/kanban/` - All UI components

## Component Structure

### Core Components
- `KanbanBoard` - Main container orchestrating all functionality
- `KanbanColumn` - Individual column with drag-drop zones
- `KanbanCard` - Task card with drag functionality
- `AddTaskDialog` - Modal for creating new tasks
- `EditTaskDialog` - Modal for editing existing tasks

### Data Flow
1. `useKanban` hook manages all state and localStorage persistence
2. `KanbanBoard` receives state and handlers from the hook
3. Components communicate through prop drilling pattern
4. All mutations go through the hook's provided functions

## Development Rules

### State Management
- **NEVER** mutate state directly in components
- Always use the provided hook functions: `addTask`, `updateTask`, `deleteTask`, `moveTask`
- State is automatically persisted to localStorage - don't implement additional persistence
- The hook handles all date serialization/deserialization for localStorage

### Component Patterns
- All components use `"use client"` directive for client-side rendering
- Props are passed down from `KanbanBoard` to child components
- Use TypeScript interfaces from `/lib/kanban-types.ts` for all props
- Maintain the existing component composition pattern

### Drag and Drop
- Uses HTML5 Drag and Drop API exclusively
- Drag data is serialized as JSON string containing `taskId` and `sourceColumnId`
- Visual feedback is handled through `isDragOver` state in columns
- NEVER implement alternative drag libraries without explicit approval

### Styling Guidelines
- Uses Tailwind CSS with custom design system
- Glass-morphism effects with backdrop-blur and transparency
- Color-coded columns: Amber (Todo), Blue (In Progress), Emerald (Done)
- Gradient backgrounds and modern rounded corners (rounded-2xl)
- Hover animations and smooth transitions (duration-200/300)

### UI/UX Standards
- Cards have priority-based left borders and gradient backgrounds
- Empty states include helpful call-to-action buttons
- All interactive elements have hover states with scale transforms
- Dialogs use backdrop blur with modern styling
- Animations are subtle and performance-optimized

## Data Persistence Rules

### localStorage Structure
- Key: `kanban-board`
- Stores complete board state including columns and tasks
- Dates are serialized as ISO strings and parsed back to Date objects
- Default board structure is created if no saved data exists

### Task Properties
```typescript
interface Task {
  id: string;           // UUID generated by hook
  title: string;        // Required, user-provided
  description?: string; // Optional
  columnId: string;     // References column.id
  priority?: Priority;  // 'low' | 'medium' | 'high'
  tags?: string[];      // Optional array of strings
  order: number;        // For sorting within columns
  createdAt: Date;      // Auto-generated
  updatedAt: Date;      // Auto-updated on changes
}
```

## Performance Considerations

### Optimization Rules
- Task lists are memoized at the column level
- Drag operations update only affected columns
- localStorage writes are debounced through the hook
- Component re-renders are minimized through proper prop passing

### Accessibility
- All interactive elements are keyboard accessible
- Drag operations provide visual feedback
- Screen reader friendly with proper ARIA labels
- Color coding is supplemented with text indicators

## Modification Guidelines

### Adding New Features
1. Define new types in `/lib/kanban-types.ts` first
2. Add new functions to `useKanban` hook if state changes are needed
3. Update component props interfaces accordingly
4. Maintain existing styling patterns and conventions

### UI Changes
- Always test both light and dark themes
- Ensure responsive design works across screen sizes
- Maintain the existing color scheme and gradient patterns
- Test drag-and-drop functionality after UI changes

### Testing Requirements
- Test localStorage persistence across browser sessions
- Verify drag-and-drop works in different browsers
- Check responsive behavior on mobile devices
- Validate form submissions and error handling in dialogs

## Error Handling

### Drag and Drop Errors
- Failed drag operations are logged but don't crash the app
- Malformed drag data is caught and ignored
- Visual feedback is always reset on drag end

### Storage Errors
- localStorage failures fallback to in-memory state
- Corrupted data is cleared and reset to default state
- All date parsing errors are handled gracefully

## Security Considerations

- No sensitive data should be stored in localStorage
- All user inputs are sanitized before storage
- XSS protection through proper React rendering
- No external API calls without explicit data validation

## Breaking Changes Policy

### Backward Compatibility
- localStorage schema changes require migration logic
- Component interface changes must be backwards compatible
- Hook function signatures should remain stable

### Deprecation Process
1. Mark old patterns as deprecated with comments
2. Provide migration path in documentation
3. Remove after at least one major version

## Common Patterns

### Adding a New Task Property
1. Update `Task` interface in types file
2. Add to default task creation in hook
3. Update both dialog components for editing
4. Add to card display if needed
5. Test localStorage serialization

### Creating New Dialog Components
- Follow existing modal patterns with backdrop blur
- Use consistent header styling with gradients
- Implement proper form validation
- Include loading states for async operations
- Test keyboard navigation and accessibility

This document should be updated whenever significant changes are made to the Kanban board architecture or patterns.